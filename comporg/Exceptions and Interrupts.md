Continues [[CPU Pipelining-Multicycle Execution]]
Continues [[Control Hazards and Branch Prcoediction]]
Continued by [[Parallelism Via Instructions]]

Implemented by [[Interrupts In Hardware]]
# Exception Vs. Interrupt
- An Exception is an unscheduled event that disrupts execution
- An Interrupt is an exception that is triggered from outside the processor
	- An interrupt is a type of exception
- ![[Pasted image 20241111182144.png]]
# LEGv8 Exception Handling Overview
- Consider that a hardware malfunction occurs during the instruction `ADD X1, X2, X1` 
- The basic action the processor must perform when an exception occurs is to save the address of the instruction in the exception link register (ELR) and then transfer control the OS at some specified address
- The OS will then perform some action the handle the exception, and then either terminate the program or return control to the program by jumping to some address based on the address in the ELR
	- Determining where to restart execution from is a problem that will be explored later
- The OS must know the reason for the exception in order to handle it.
- There are two methods to communicate the reason
	- LEGv8 uses an Exception Syndrome Register (ESR) that holds a field that indicates a reason for the exception
	- A second method is to use **Vectored Interrupts**, where the address that is jumped to is determined by the reason for the exception
# Exception Handling Implementation
- First, two registers must be added to the design
	- ESR: 32 bits
		- A field within this register indicates the cause of the exception
			- 8 is undefined instruction
			- 10 is arithmetic overflow/underflow
			- 12 is hardware malfunction
	- ELR: 64 bits
- ![[Pasted image 20241111183253.png]]
	- Three new control signals are generated by the control unit
		- ID.Flush
			- This is ORRed with the already existing ID.Flush from the Hazard detector and determines whether the ID/EX register should be zeroed
		- EX.Flush
			- Zeros the EX/MEM Register to initiate a nop
		- An additional bit to control the PC source mux
			- In the case of an exception, the PC source will be hardwired to the address of the exception handling code
				- In LEGv8 this is 0x0000 0000 1C09 0000
## Multiple Exceptions
- If there are multiple exceptions in one clock cycle, the ESR will hold a field that indicates which instruction caused the earliest exception
	- The earliest exceptions will be handled first
## Precise and Imprecise Exceptions
- Placing the exact address of the offending instruction into the ELR can be quite challenging
	- An ISA that supports **Imprecise Exceptions** does not guarantee that the ELR holds the address of the offending instruction
		- It leaves it up to the OS to determine which instruction went wrong
	- An ISA that supports **Precise Exceptions** guarantees the ELR holds the address of the excepting instruction
		- Easier for OS designer, ensures stability and security
For class #comporg